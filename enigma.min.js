window.key="",window.__defineGetter__("key",()=>["Q","W","E","R","T","Y","U","I","O","P","A","S","D","F","G","H","J","K","L","Z","X","C","V","B","N","M"].reduce((b,a)=>b.splice(Math.floor(Math.random()*b.length),0,a)&&b,[]).join("").split("").reduce((b,a)=>b.splice(Math.floor(Math.random()*b.length),0,a)&&b,[]).join(""));var basicKey="QlUgUEUgU0QgUkMgSlo6SlogSEwgVFcgWE4gRFYgR1EgS1UgQlAgUkEgSU0gU0YgT1kgRUM6WklOUUtET1dBTFRVSEdGVkNCTVBTWFlSSkU+MTcmOSYxMyYyMCYxOSYxIVpVVFFGQ0RTUktKQk9IV0dWTU5MRVBJQVlYPjImNSYxNCYyJjEmNSFRSVBXVU1IWExCWUFEWkNFVk9KS1JTR05URj4zJjYhR0RFU1ZaT0tXUkpCWENZTlRQRlFBTFVNSUg+MTEmMjImMiYxNiYxJjE4JjI0JjE4JjIwIUNaRE1VV0JPWVNWUFJJS05RTEVIR1hURkFKPjQmNSYxMCYzJjE1JjExIUpRUFVLQ0RCR1dIU09BTk1GVExZUlZYRUlaPjgmMTYhRUtaT1dBRExSUElIQ1FKVlRTWEJGTU5HWVU+NiYxMiYyNSYyMCYxIVVDQkRKWVJNWklGTEVWSEdOWE9UQVBTV1FLPjEwJjEyJjIxIURZSlVNUENFTFhTV09HRlJUTlpCSEtRQUlWPjIyJjE5JjExJjEyJjIyIUJMUVlWVENNSUdXREFSU0VaRk5QSkhLT1hVPjIwJjIzJjExIVFHWldPWFZVQ0ZNSlJIQkVMVEFQWVNJTkRLPjYmMTAmMyY3IUJOS01TV1lFTERBSk9GWFBVR1FIWlRDSVZSPjghUVBWV0dDUkxUSUhLREpNWFVORU9CQVpTRlk+MjEmMjUhREZMQlhaV0pLTkVST1ZVSElZUE1HQVNUUUM+MTQmMTYmNyY1JjMmMjUmMiYxJjE1JjE4JjQmMjMhQ1dKRFhQTlNBRU1VR1lLWlZJTEhGT0JRVFI+NCYxNSYxMyYyNjpBUlVDUlVLRlFTQVRQSVpL";window.genKey=()=>{var a=Math.floor(13*Math.random())+1,b=window.key.replace(/(\w\w)/gi,"$1 ").trim().split(" ").splice(Math.floor(Math.random()*(13-a)),a).join(" "),c=window.key.replace(/(\w\w)/gi,"$1 ").trim(),d=[],e=[window.key[Math.round(26*Math.random())]];do{var f=[];do f.push(1+Math.floor(26*Math.random()));while(.75>Math.random());d.push(window.key+">"+f.join("&")),e.push(window.key[Math.round(26*Math.random())])}while(.75>Math.random());return d=d.join("!"),e=e.join(""),btoa(b+":"+c+":"+d+":"+e)};function isUpperCase(a){return a==a.toUpperCase()}function Enigma(a){if(this.rotors=[],this.reflector=null,this.plugboard=null,a)try{a=atob(a);var b=a.toUpperCase().split(":");switch(this.plugboard=new Enigma.Plugboard(b[0].split(" ")),b[1]){default:this.reflector=new Enigma.Reflector(b[1].split(" "));}for(var c=b[2].split("!"),d=b[3].split(""),e=0;e<c.length;e++)this.rotors.push(new Enigma.Rotor(c[e].split(">")[0],d[e],c[e].split(">")[1].split("&")))}catch(a){throw new Error("Invalid setup KEY: "+a.message)}}Enigma.prototype.encode=function(a){var b={encoded:"",capMap:[]};a+="?encoded=true",a=btoa(a);for(var c,d=function(a){return function(b){b=a.plugboard.encode(b);for(var c=a.rotors.length-1;0<=c;c--)b=a.rotors[c].encode(b,"left",c);b=a.reflector.encode(b);for(var c=0;c<a.rotors.length;c++)b=a.rotors[c].encode(b,"right",c);return b=a.plugboard.encode(b),b}}(this),e=0;e<a.length;e++)c=a.split("")[e],b.capMap.push(isUpperCase(c)),b.encoded+="ABCDEFGHIJKLMNOPQRSTUVWXYZ".includes(c.toUpperCase())?(encodded=d(c),this.spin(),encodded):c;return b.encoded=atob(b.encoded),Enigma.stringify(b)},Enigma.prototype.decode=function(a){a=Enigma.parse(a);for(var b,c=btoa(a.encoded),d=a.capMap,e="",f=function(a){return function(b){b=a.plugboard.encode(b);for(var c=a.rotors.length-1;0<=c;c--)b=a.rotors[c].encode(b,"left",c);b=a.reflector.encode(b);for(var c=0;c<a.rotors.length;c++)b=a.rotors[c].encode(b,"right",c);return b=a.plugboard.encode(b),b}}(this),g=0;g<c.length;g++)b=c.split("")[g],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZ".includes(b.toUpperCase())?(encodded=f(b),this.spin(!0),encodded):b;e=e.split("");for(var g=0;g<Math.min(d.length,e.length);g++)e[g]=d[g]?e[g].toUpperCase():e[g].toLowerCase();return e=atob(e.join("")),e=(e=e.split("?"),e.pop(),e).join("?"),e},Enigma.prototype.spin=function(){this.rotors[this.rotors.length-1].spin((this.rotors.length-1)%2);for(var a=this.rotors.length-1;0<a;a--)this.rotors[a].needsUpdate&&(this.rotors[a-1].spin((a-1)%2),this.rotors[a].needsUpdate=!1)},Enigma.prototype.reset=function(){for(var a=0;a<this.rotors.length;a++)this.rotors[a].reset()},Enigma.Rotor=function(a,b,c){for(var d=0;d<c.length;d++)c[d]=parseInt(c[d]);this.wiringMaze=a,b="ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(b),this.rotation=0<=b?b:0,this.defaultPosition=this.rotation,this.pins=c,this.needsUpdate=!1},Enigma.Rotor.prototype.reset=function(){this.rotation=this.defaultPosition},Enigma.Rotor.prototype.spin=function(a){var b=a?-1:1;for(this.rotation+=b,this.rotation%=26;0>this.rotation;)this.rotation+=26;this.pins.includes(this.rotation+1)&&(this.needsUpdate=!0)},Enigma.Rotor.prototype.encode=function(a,b){function c(a,b){if("ABCDEFGHIJKLMNOPQRSTUVWXYZ".includes(a.toUpperCase())){for(var c="ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(a.toUpperCase()),d=(b+c)%26;0>d;)d+=26;return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[d]}return!1}function d(a){if(g.includes(a.toUpperCase())){var b=(g.indexOf(a.toUpperCase())+1)%26;return g[b]}return!1}function e(a){if(g.includes(a.toUpperCase())){for(var b=(g.indexOf(a.toUpperCase())-1)%26;0>b;)b+=26;return g[b]}return!1}var f,g=this.wiringMaze,h=this.rotation;switch(b){case"left":f=c(d(c(a,h)),h);break;case"right":f=c(e(c(a,-h)),-h);break;default:f=a;}return f},Enigma.Plugboard=function(a){this.connections=[],this.plugin(a)},Enigma.Plugboard.prototype.encode=function(a){for(var b=a.toUpperCase(),c=0;c<this.connections.length;c++)switch(this.connections[c].indexOf(a.toUpperCase())){case 0:b=this.connections[c].split("")[1];break;case 1:b=this.connections[c].split("")[0];break;default:}return b},Enigma.Plugboard.prototype.unplug=function(a){for(var b=0;b<a.length;b++)this.connections.includes(a[b])&&this.connections.splice(this.connections.indexOf(a[b]),1)},Enigma.Plugboard.prototype.plugin=function(a){for(var b=0;b<a.length;b++)this.connections.includes(a[b])||this.connections.push(a[b])},Enigma.Plugboard.prototype.setPlugboard=function(a){this.connections=a},Enigma.Reflector=function(a){if(13>a.length)throw{message:"not enough connections in the Reflector"};this.connections=a},Enigma.Reflector.prototype.encode=function(a){for(var b=a.toUpperCase(),c=0;c<this.connections.length;c++)switch(this.connections[c].indexOf(a.toUpperCase())){case 0:b=this.connections[c].split("")[1];break;case 1:b=this.connections[c].split("")[0];break;default:}return b},Enigma.stringify=function(a){var b="";b+=a.encoded+";";for(var c=0;c<a.capMap.length;c++)b+=a.capMap[c]?1:0;return b},Enigma.parse=function(a){var b={encoded:"",capMap:[]},c=a.split(";"),d=c.pop();b.encoded=c.join(";");for(var e=0;e<d.length;e++)b.capMap.push(!("1"!=d[e]));return b};
